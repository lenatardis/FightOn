<!doctype html>
<html lang="uk">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>FightON</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root{
            /* підняти персонажів на верхню кромку асфальту */
            --char-drop: -5.5vh;
            --header-h: 64px;
        }

        /* базове */
        html,body{margin:0;background:#0b1020;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
        body{padding-top:64px}
        section,.stage{scroll-margin-top:var(--header-h)}

        /* Сцена ~200vh */
        .stage{position:relative;height:200vh;overflow:hidden}
        .layer{position:absolute;inset:0;pointer-events:none}
        .band{
            position:absolute;left:0;bottom:0;height:100%;
            display:flex;align-items:flex-end;gap:0;
            width:max-content; /* ключ! дозволяє ширині дорівнятись контенту */
            will-change:transform;
            white-space:nowrap;
        }
        .band::after{content:"";flex:0 0 10vw}

        /* порядок шарів */
        #sky{z-index:1} #sun{z-index:2} #clouds{z-index:3}
        #mountains{z-index:4} #houses{z-index:5} #street{z-index:6} #chars{z-index:7}

        /* Небо */
        #sky{
            background:
                    radial-gradient(900px 520px at 65% 10%, rgba(255,255,255,.18) 0%, rgba(255,255,255,0) 60%),
                    linear-gradient(180deg,#00E5FF 0%,#22DAFF 30%,#5FE6FF 60%,#C4F7FF 85%,#F2FEFF 100%);
        }
        #sky::before{
            content:"";position:absolute;left:50%;top:8vh;transform:translateX(-50%);
            width:70vmin;height:70vmin;border-radius:50%;
            background:radial-gradient(circle at 50% 50%,#fff 0 10%,#fff8 10% 26%,#fff3 26% 42%,transparent 60%);
            filter:blur(18px);opacity:.35
        }
        /* тінь землі */
        .stage::after{
            content:"";position:absolute;left:-5vw;right:-5vw;bottom:-6vh;height:22vh;
            background:radial-gradient(120% 150% at 50% 115%,rgba(0,0,0,.35) 0%,rgba(0,0,0,.18) 38%,rgba(0,0,0,0) 72%);
            z-index:3;pointer-events:none
        }

        /* Лого поверх усього */
        .stage-logo{position:absolute;top:calc(var(--header-h) + 8px);left:50%;transform:translateX(-50%);z-index:9;pointer-events:none}
        .stage-logo img{width:clamp(140px,32vw,360px);height:auto;filter:drop-shadow(0 6px 14px rgba(0,0,0,.25))}

        /* Сонце — трохи нижче й позаду гір */
        #sun{display:grid;place-items:center}
        .sunImg{
            width:min(22vmax,420px);height:auto;position:absolute;left:50%;transform:translateX(-50%);
            bottom:39%; /* було занадто високо */
            filter:blur(.25px);opacity:.92
        }

        /* Хмари — видно у верхній половині сцени */
        #clouds .cloudImg{
            height:24vh;width:auto;margin:0 8vw 58vh;opacity:.98;
            filter:drop-shadow(0 6px 14px rgba(0,0,0,.12))
        }

        /* Гори (позаду будинків) */
        .mountainsImg{
            height:32vh;width:auto;margin:0 8vw 14vh;
            filter:drop-shadow(0 10px 24px rgba(0,0,0,.25))
        }

        /* Будинки (реальна висота) */
        .houseImg{
            height:44vh;width:auto;margin:0 40px 11vh;
            filter:drop-shadow(0 10px 26px rgba(0,0,0,.28))
        }

        /* Вулиця (асфальт + верхня біла кромка у самому SVG) */
        .streetImg{height:26vh;width:auto;margin:0}

        /* Персонажі — встають на верхню кромку асфальту */
        .charImg{
            width:240px;height:auto;margin:0 96px 0;transform:translateY(var(--char-drop));
            filter:drop-shadow(0 12px 34px rgba(0,0,0,.35))
        }
        .charImg.sm{width:200px}.charImg.lg{width:280px}

        @media (max-width:780px){
            :root{--char-drop:-5vh}
            .houseImg{height:40vh;margin-bottom:10vh}
            .streetImg{height:25vh}
        }

        /* Header */
        .site-header{
            position:fixed;top:0;left:0;right:0;z-index:10000;height:64px;
            display:flex;align-items:center;gap:16px;padding:0 18px;
            backdrop-filter:blur(10px);
            background:linear-gradient(180deg,rgba(10,14,30,.72),rgba(10,14,30,.46));
            border-bottom:1px solid rgba(255,255,255,.08)
        }
        .site-header .logo{font-family:"Bangers",cursive;font-size:26px;letter-spacing:.6px;color:#fff;text-decoration:none;text-shadow:2px 2px 0 #111}
        .main-nav{margin-left:auto;display:flex;gap:12px;flex-wrap:wrap}
        .nav-link{
            display:inline-flex;align-items:center;height:36px;padding:0 12px;border-radius:10px;
            color:#e9f2ff;text-decoration:none;font-weight:700;letter-spacing:.2px;
            background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);
            transition:transform .15s, background .15s, border-color .15s
        }
        .nav-link:hover{transform:translateY(-1px);background:rgba(255,255,255,.10)}
        .nav-link.active{background:#ffd400;color:#111;border-color:#111;box-shadow:4px 4px 0 #111}

        /* Hamburger */
        .nav-toggle{display:none;margin-left:auto;width:40px;height:40px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);border-radius:10px;cursor:pointer;align-items:center;justify-content:center}
        .nav-toggle-bar{display:block;width:22px;height:2px;background:#fff;border-radius:2px;position:relative}
        .nav-toggle-bar::before,.nav-toggle-bar::after{content:"";position:absolute;left:0;right:0;height:2px;background:#fff;border-radius:2px}
        .nav-toggle-bar::before{top:-7px}.nav-toggle-bar::after{top:7px}
        @media (max-width:780px){
            .site-header{height:58px;padding:0 12px} body{padding-top:58px}
            .nav-link{height:44px;padding:0 12px;font-size:15px}
            .nav-toggle{display:inline-grid}
            .main-nav{
                position:fixed;top:var(--header-h);left:0;right:0;display:grid;gap:8px;padding:10px;
                background:linear-gradient(180deg,rgba(10,14,30,.92),rgba(10,14,30,.82));
                border:1px solid rgba(255,255,255,.10);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.45);
                transform-origin:top right;transform:translateY(-8px) scale(.98);opacity:0;pointer-events:none;
                transition:transform .18s, opacity .18s;z-index:10001
            }
            .main-nav .nav-link{width:100%;justify-content:flex-start}
        }
        .nav-open .main-nav{opacity:1;pointer-events:auto;transform:translateY(0) scale(1)}
        .nav-open #navToggle .nav-toggle-bar{background:transparent}
        .nav-open #navToggle .nav-toggle-bar::before{top:0;transform:rotate(45deg)}
        .nav-open #navToggle .nav-toggle-bar::after{top:0;transform:rotate(-45deg)}
        @media (max-width:780px){
            .site-header{transition:transform .22s ease}
            html.popup-open .site-header{transform:translateY(-100%)}
            html.popup-open .main-nav{opacity:0 !important;pointer-events:none !important}
        }
    </style>
</head>
<body>

<header class="site-header" id="siteHeader">
    <a class="logo" href="#stage">CYBERGAME</a>
    <button class="nav-toggle" id="navToggle" aria-label="Відкрити меню" aria-controls="primaryNav" aria-expanded="false">
        <span class="nav-toggle-bar"></span>
    </button>
    <nav class="main-nav" id="primaryNav" aria-label="Main">
        <a class="nav-link" href="#stage" data-target="#stage">Початок</a>
        <a class="nav-link" href="#phone" data-target="#phone">Телефон</a>
        <a class="nav-link" href="#gorilla" data-target="#gorilla">Горіла</a>
        <a class="nav-link" href="#char-2" data-target="#char-2">Кібер бой</a>
        <a class="nav-link" href="#billboard" data-target="#billboard">Відео</a>
        <a class="nav-link" href="#faq" data-target="#faq">FAQ</a>
    </nav>
</header>

<div class="stage" id="stage">
    <div class="stage-logo"><img src="./assets/fighton.png" alt="FightTON logo"></div>

    <!-- Небо -->
    <div class="layer" id="sky"><div class="band" id="skyBand"></div></div>

    <!-- Сонце -->
    <div class="layer" id="sun">
        <img class="sunImg" src="./assets/sun.svg" alt="Sun">
    </div>

    <!-- Хмари -->
    <div class="layer" id="clouds">
        <div class="band" id="cloudsBand">
            <img class="cloudImg" src="./assets/cloud_left_top.svg" alt="Cloud">
            <img class="cloudImg" src="./assets/cloud_right_top.svg" alt="Cloud">
            <img class="cloudImg" src="./assets/cloud_left_bottom.svg" alt="Cloud">
            <img class="cloudImg" src="./assets/cloud_right_bottom.svg" alt="Cloud">
        </div>
    </div>

    <!-- Гори -->
    <div class="layer" id="mountains">
        <div class="band" id="mountainsBand">
            <img class="mountainsImg" src="./assets/mountains.svg" alt="Mountains" style="margin-left:8vw">
            <img class="mountainsImg" src="./assets/mountains.svg" alt="Mountains" style="margin-right:8vw">
        </div>
    </div>

    <!-- Будинки -->
    <div class="layer" id="houses">
        <div class="band" id="housesBand">
            <img class="houseImg" src="./assets/house1.png" alt="House1" style="margin-left:6vw">
            <img class="houseImg" src="./assets/house2.png" alt="House2">
            <img class="houseImg" src="./assets/house3.png" alt="House3">
            <img class="houseImg" src="./assets/house4.png" alt="House4">
            <img class="houseImg" src="./assets/house5.png" alt="House5">
            <img class="houseImg" src="./assets/house6.png" alt="House6">
            <img class="houseImg" src="./assets/house7.png" alt="House7">
            <img class="houseImg" src="./assets/house8.png" alt="House8">
            <img class="houseImg" src="./assets/house9.png" alt="House9" style="margin-right:8vw">
        </div>
    </div>

    <!-- Вулиця -->
    <div class="layer" id="street">
        <div class="band" id="streetBand">
            <img class="streetImg" src="./assets/street.svg" alt="Street" style="margin-left:6vw">
            <img class="streetImg" src="./assets/street.svg" alt="Street" style="margin-right:8vw">
        </div>
    </div>

    <!-- Персонажі -->
    <div class="layer" id="chars">
        <div class="band" id="charsBand">
            <img class="charImg" src="./assets/Sniper.svg" alt="Sniper" style="margin-left:6vw">
            <img class="charImg" src="./assets/Gorilla.svg" alt="Gorilla">
            <img class="charImg" src="./assets/Mobster.svg" alt="Mobster">
            <img class="charImg" src="./assets/Snap.svg" alt="Snap">
            <img class="charImg" src="./assets/Cuadrilla.svg" alt="Cuadrilla">
            <img class="charImg" src="./assets/Shelldren.svg" alt="Shelldren">
            <img class="charImg" src="./assets/Pistolero.svg" alt="Pistolero">
            <img class="charImg" src="./assets/Machetero.svg" alt="Machetero">
            <img class="charImg lg" src="./assets/Golfer.svg" alt="Golfer" style="margin-right:8vw">
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollTrigger.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollToPlugin.min.js"></script>
<script>
    gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);
    gsap.config({nullTargetWarn:false});

    /* чекаємо, поки ВСІ зображення в #stage завантажаться — тільки тоді рахуємо ширини */
    function waitImages(root){
        const imgs = Array.from(root.querySelectorAll('img'));
        const pending = imgs.filter(i => !i.complete || i.naturalWidth === 0);
        return Promise.all(pending.map(img => new Promise(res => {
            img.addEventListener('load', res, {once:true});
            img.addEventListener('error', res, {once:true});
        })));
    }

    function getShift(sel, k=1){
        const el = document.querySelector(sel);
        if(!el) return 0;
        const fullWidth = Math.max(el.scrollWidth, el.getBoundingClientRect().width);
        const full = Math.max(0, fullWidth - window.innerWidth);
        return -Math.round(full * k);
    }

    async function initParallax(){
        await waitImages(document.getElementById('stage')); // важливо!
        ScrollTrigger.killAll(false); // не чіпаємо нативний скрол

        const tl = gsap.timeline({
            scrollTrigger:{
                id:"stageParallax",
                trigger:"#stage",
                start:"top top",
                end:() => {
                    const el = document.getElementById('charsBand');
                    const width = el ? Math.max(el.scrollWidth, el.getBoundingClientRect().width) : window.innerWidth*3;
                    return "+=" + Math.max(2200, Math.round((width - innerWidth) * 1.35));
                },
                pin:true, scrub:1, anticipatePin:1, invalidateOnRefresh:true
            }
        });

        tl.to("#mountainsBand",{x:() => getShift("#mountainsBand",0.28), ease:"none"},0)
            .to("#housesBand",   {x:() => getShift("#housesBand",   0.72), ease:"none"},0)
            .to("#streetBand",   {x:() => getShift("#streetBand",   0.90), ease:"none"},0)
            .to("#charsBand",    {x:() => getShift("#charsBand",    1.00), ease:"none"},0)
            .to(".sunImg",{yPercent:-8, scale:0.97, ease:"none"},0);

        // Хмари: роз’їхались і зникли у першій третині
        const clouds = gsap.utils.toArray("#clouds .cloudImg");
        clouds.forEach((c,i)=>{
            const dir = (i%2===0)?-1:1;
            tl.to(c,{
                x:() => dir * (innerWidth * 0.45),
                y:(i%3===0)?-20:8,
                opacity:0, ease:"power1.inOut"
            },0);
        });
        tl.addLabel("cloudsGone", tl.duration()*0.32)
            .add(()=> gsap.set("#clouds",{pointerEvents:"none"}), "cloudsGone");

        ScrollTrigger.refresh(); // після побудови
    }

    initParallax();
    addEventListener('resize', () => ScrollTrigger.refresh());

    /* ——— Свайп (мобілка) ——— */
    (function(){
        if (!matchMedia('(max-width:780px)').matches) return;
        const stage = document.getElementById('stage');
        let x0=null, y0=null;

        function headerH(){ const h=document.getElementById('siteHeader'); return h?Math.round(h.getBoundingClientRect().height):0; }
        stage.addEventListener('touchstart', e => { const t=e.touches?.[0]; if(!t) return; x0=t.clientX; y0=t.clientY; }, {passive:true});
        stage.addEventListener('touchend', e => {
            if(x0==null) return;
            const t = e.changedTouches?.[0]; if(!t){x0=y0=null;return;}
            const dx=t.clientX-x0, dy=Math.abs(t.clientY-(y0||0));
            if(Math.abs(dx)>40 && Math.abs(dx)>dy*1.2){
                const ST=ScrollTrigger.getById('stageParallax');
                const curr=scrollY, step=Math.max(innerHeight*0.45, Math.min(innerHeight*0.9, Math.abs(dx)*8));
                const delta = dx<0 ? step : -step;
                let target = curr + delta;
                if(dx<0 && curr>=(ST.end-4)){
                    gsap.to(window,{duration:.65,ease:"power2.out",scrollTo:{y:"#phone",offsetY:headerH()}});
                }else{
                    target = gsap.utils.clamp(ST.start, ST.end, target);
                    gsap.to(window,{duration:.55,ease:"power2.out",scrollTo:target});
                }
            }
            x0=y0=null;
        }, {passive:true});
    })();

    /* ——— Меню/Активні лінки/ScrollTo ——— */
    function setActiveById(id){
        document.querySelectorAll('.nav-link').forEach(a=>{
            const target=a.dataset.target||a.getAttribute('href');
            a.classList.toggle('active', target===id);
        });
    }
    const header=document.getElementById('siteHeader');
    const headerH=()=>Math.round(header.getBoundingClientRect().height);
    function syncHeaderVar(){ document.documentElement.style.setProperty('--header-h', headerH()+'px'); }
    syncHeaderVar();

    document.querySelectorAll('.nav-link').forEach(a=>{
        a.addEventListener('click', e=>{
            e.preventDefault();
            const sel=a.dataset.target||a.getAttribute('href');
            setActiveById(sel);
            gsap.to(window,{duration:.8,ease:'power2.out',scrollTo:{y:sel,offsetY:headerH()}});
        });
    });
    document.querySelector('.logo')?.addEventListener('click', e=>{
        e.preventDefault(); setActiveById('#stage');
        gsap.to(window,{duration:.8,ease:'power2.out',scrollTo:{y:'#stage',offsetY:headerH()}});
    });

    const SECTIONS=['#stage','#phone','#gorilla','#char-2','#billboard','#faq'];
    let currentActive=null, rafRun=false;
    function updateActive(){
        rafRun=false; const y=headerH(), H=10; let win=null;
        for(const id of SECTIONS){
            const el=document.querySelector(id); if(!el) continue;
            const r=el.getBoundingClientRect();
            if(r.top<=y+H && r.bottom>y+H){win=id;break;}
        }
        if(!win){
            let best=Infinity;
            for(const id of SECTIONS){
                const el=document.querySelector(id); if(!el) continue;
                const r=el.getBoundingClientRect(); const d=Math.abs(r.top-y);
                if(d<best){best=d;win=id;}
            }
        }
        if(win&&win!==currentActive){currentActive=win;setActiveById(win);}
    }
    addEventListener('scroll', ()=>{ if(!rafRun){rafRun=true;requestAnimationFrame(updateActive);} }, {passive:true});
    addEventListener('resize', ()=>{ syncHeaderVar(); updateActive(); ScrollTrigger.refresh(); });
    addEventListener('load', ()=>{
        const hash=location.hash;
        if(hash && document.querySelector(hash)){
            gsap.set(window,{scrollTo:{y:hash,offsetY:headerH(),autoKill:false}});
        }
        updateActive();
        ScrollTrigger.refresh();
    });

    /* ——— Mobile hamburger ——— */
    const navToggle=document.getElementById('navToggle');
    function closeNav(){ document.documentElement.classList.remove('nav-open'); navToggle?.setAttribute('aria-expanded','false'); }
    function openNav(){ document.documentElement.classList.add('nav-open'); navToggle?.setAttribute('aria-expanded','true'); }
    function toggleNav(){ document.documentElement.classList.contains('nav-open')?closeNav():openNav(); }
    navToggle?.addEventListener('click', toggleNav);
    document.querySelectorAll('.main-nav .nav-link').forEach(a=>a.addEventListener('click', ()=>closeNav(), {capture:true}));
    addEventListener('keydown', e=>{ if(e.key==='Escape') closeNav(); });
    addEventListener('resize', ()=>{ if(matchMedia('(min-width:781px)').matches) closeNav(); });
</script>
</body>
</html>
