<!doctype html>
<html lang="uk">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>FightON</title>
    <link type="text/css" rel="stylesheet" href="assets/fonts/fonts.css">
    <style>
        :root {
            /* висоти секцій */
            --header-h: 64px;
            --intro-h: 120vh; /* скільки «неба» перед сценою */

            /* pinned-сцена з героями */
            --stage-h: 108vh; /* одразу видно героїв */

            /* земля / паретаж */
            --ground-h: 40vh;
            --snow-h: 50px;
            --mountains-k: 0.85;
            --sun-k: 0.90;

            /* позиція героїв */
            --char-drop: -25vh;

            /* лід-відступи (рахуються в JS) */
            --mountains-lead: 0px;
            --houses-lead: 0px;
        }

        html, body {
            margin: 0;
            background: #7B8CF1;
            color: #fff;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
        }

        body { padding-top: var(--header-h); }

        /* header*/
        .site-header{
            position: fixed; inset: 0 0 auto 0; height: var(--header-h); z-index: 10000;
            display: flex; align-items: center; justify-content: center;
            gap: 16px; padding: 0 18px;

            backdrop-filter: saturate(140%) blur(10px);
            -webkit-backdrop-filter: saturate(140%) blur(10px);

            background: linear-gradient(
                    180deg,
                    rgba(11,16,32,0.14) 0%,
                    rgba(11,16,32,0.06) 60%,
                    rgba(11,16,32,0.02) 100%
            );
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }

        .main-nav { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }

        .nav-link {
            position: relative; display: inline-flex; align-items: center;
            height: 36px; padding: 0 12px; border-radius: 10px;
            color: #e9f2ff; font-family: 'Lucznik', sans-serif; text-transform: uppercase;
            text-decoration: none; font-weight: 700; letter-spacing: .2px;
            background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.10);
            transition: transform .15s ease, background .15s ease, border-color .15s ease;
        }
        .nav-link:hover { transform: translateY(-1px); background: rgba(255,255,255,.10); }

        .intro, .stage, section { scroll-margin-top: var(--header-h); }

        .nav-toggle {
            display: none; margin-left: 0; width: 40px; height: 40px;
            border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.06);
            border-radius: 10px; cursor: pointer; align-items: center; justify-content: center;
        }
        .nav-toggle-bar { display: block; width: 22px; height: 2px; background: #fff; border-radius: 2px; position: relative; }
        .nav-toggle-bar::before, .nav-toggle-bar::after {
            content:""; position:absolute; left:0; right:0; height:2px; background:#fff; border-radius:2px;
        }
        .nav-toggle-bar::before{ top:-7px; } .nav-toggle-bar::after{ top:7px; }

        @media (max-width: 780px) {
            .site-header { height: 58px; padding: 0 12px; }
            body { padding-top: 58px; }
            .nav-link { height: 44px; padding: 0 12px; font-size: 15px; }
            .nav-toggle { display: inline-grid; position: absolute; right: 12px; }
            .main-nav {
                position: fixed; top: var(--header-h); left: 0; right: 0; display: grid; gap: 8px; padding: 10px;
                background: linear-gradient(180deg, rgba(11,16,32,0.14) 0%, rgba(11,16,32,0.06) 60%, rgba(11,16,32,0.02) 100%);
                border: 1px solid rgba(255,255,255,.10); border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0,0,0,.45); transform-origin: top center;
                transform: translateY(-8px) scale(.98); opacity: 0; pointer-events: none;
                transition: transform .18s ease, opacity .18s ease; z-index: 10001;
            }
            .nav-open .main-nav { opacity: 1; pointer-events: auto; transform: translateY(0) scale(1); }
            .nav-open #navToggle .nav-toggle-bar{ background: transparent; }
            .nav-open #navToggle .nav-toggle-bar::before{ top:0; transform: rotate(45deg); }
            .nav-open #navToggle .nav-toggle-bar::after{ top:0; transform: rotate(-45deg); }
        }

        /*intro */
        .sky-gradient1 {
            background: radial-gradient(900px 520px at 65% 10%, rgba(255,255,255,.18) 0, rgba(255,255,255,0) 60%),
            linear-gradient(180deg,#7B8CF1 0%,#6FA2FA 28%,#699BD8 100%);
        }
        .sky-gradient2 { background: linear-gradient(180deg,#699BD8 0%,#82ABDD 28%,#ACBEB4 100%); }

        .intro { position: relative; height: var(--intro-h); overflow: hidden; }
        .intro-logo { position: absolute; left: 50%; top: 16vh; transform: translateX(-50%); z-index: 3; pointer-events: none; }
        .intro-logo img { width: min(48vmax,760px); height: auto; filter: drop-shadow(0 10px 26px rgba(0,0,0,.28)); }

        .intro .cloud { position: absolute; z-index: 2; filter: drop-shadow(0 6px 14px rgba(0,0,0,.12)); }
        .intro .cloud img { height: 22vh; width: auto; }
        .cloud--lt{ left:6vw; top:22vh; } .cloud--rt{ right:6vw; top:22vh; }
        .cloud--lb{ left:12vw; bottom:40vh; } .cloud--rb{ right:12vw; bottom:40vh; }

        .stage { position: relative; height: var(--stage-h); overflow: hidden; }
        .layer { position: absolute; inset: 0; pointer-events: none; }
        .band { position: absolute; left: 0; bottom: 0; height: 100%; min-width: 100%; display: flex; align-items: flex-end; white-space: nowrap; will-change: transform; transform: translateZ(0); }
        .band::after { content:""; flex:0 0 0; }

        #sky{ z-index:1 } #sun{ z-index:2 } #mountains{ z-index:4 } #streetGround{ z-index:5 } #streetSnow{ z-index:6 } #houses{ z-index:7 } #chars{ z-index:8; pointer-events:auto; }

        #sky::before{
            content:""; position:absolute; left:50%; top:6vh; transform:translateX(-50%);
            width:64vmin; height:64vmin; border-radius:50%;
            background: radial-gradient(circle at 50% 50%, #fff 0 10%, #fff8 10% 26%, #fff3 26% 42%, transparent 60%);
            filter: blur(16px); opacity:.22;
        }

        #sun{ display:grid; place-items:center; }
        .sunImg{ width:min(22vmax,420px); height:auto; position:absolute; left:50%; transform:translateX(-50%); bottom: calc(var(--ground-h)*var(--sun-k) + 8vh); opacity:.93; filter:blur(.2px); }
        @media (max-width:780px){ .sunImg{ bottom: calc(var(--ground-h)*var(--sun-k) + 19vh); } }

        .mountainsImg{ height:32vh; width:auto; margin:0 0 10vh; }
        #mountains .mountainsImg:first-child{ margin-left: var(--mountains-lead); }
        #mountainsBand{ bottom: calc(var(--ground-h) * var(--mountains-k)); }
        #mountains .mountainsImg:nth-of-type(2){ margin-left:-2px; }

        .houseImg{ height:44vh; width:auto; margin:0 36px 0; filter: drop-shadow(0 10px 26px rgba(0,0,0,.28)); }
        #houses .houseImg:first-child{ margin-left: var(--houses-lead); }
        #housesBand{ bottom: var(--ground-h); }

        #streetGround .band{ background:url("./assets/street_ground.jpg") repeat-x left bottom; background-size:auto var(--ground-h); }
        .streetGroundSpacer{ width:600vw; height:var(--ground-h); }
        #streetSnow .band{ position:relative; }
        #streetSnow .snowLine{ position:absolute; left:0; right:0; bottom:var(--ground-h); height:var(--snow-h); background:#fff; pointer-events:none; }
        .streetSnowSpacer{ width:600vw; height:0; }

        .charImg{ position:relative; display:inline-block; width:240px; margin:0 90px 0; transform: translateY(var(--char-drop)); filter: drop-shadow(0 12px 34px rgba(0,0,0,.35)); vertical-align:bottom; will-change:transform; }
        .charImg.sm{ width:200px; } .charImg.lg{ width:280px; }
        .charImg>img.base{ display:block; width:100%; height:auto; position:relative; z-index:2; }
        .charImg>img.hover{ position:absolute; left:50%; bottom:0; transform:translateX(-50%); height:100%; width:auto; margin:0; opacity:0; pointer-events:none; transition: opacity .18s ease; object-fit:contain; object-position:center bottom; z-index:2; }
        .charImg:hover>img.hover, .charImg:focus-visible>img.hover, .charImg.is-touch>img.hover{ opacity:1; }
        #charsBand>.charImg:first-child{ margin-left:5vw; }

        .charPlate{ position:absolute; left:50%; transform:translateX(-50%); top: calc(100% + 15px); z-index:1; pointer-events:none; background:#111; color:#fff; padding:20px; border-radius:14px; box-shadow:0 0 0 3px #fff, 0 8px 18px rgba(0,0,0,.35); display:none; }
        .charPlate__inner{ display:flex; column-gap:15px; }
        .charPlate__inner p{ margin:0; }
        .charPlate::before, .charPlate::after{
            content:""; position:absolute; left: var(--plate-tip-x,50%); transform:translateX(-50%); width:0; height:0;
            border-left:10px solid transparent; border-right:10px solid transparent; pointer-events:none;
        }
        .charPlate::before{ top:-13px; border-bottom:13px solid #fff; }
        .charPlate::after{ top:-11px; border-bottom:11px solid #ffffff; }
        .charPlate .column_1,.charPlate .column_2{ display:flex; flex-direction:column; row-gap:12px; width:100%; }
        .charPlate .column_1>div,.charPlate .column_2>div{ display:flex; justify-content:space-between; align-items:center; border-bottom:1px dashed #ffffff; }
        .charPlate p{ font-size:14px; line-height:1em; font-family:'Lucznik', sans-serif; }
        .charPlate span{ display:block; margin-left:10px; font-size:12px; line-height:12px; font-family:'Gotham', sans-serif; }
        .charImg:hover .charPlate, .charImg:focus-visible .charPlate, .charImg.is-touch .charPlate{ display:block; }
        #charsBand>.charImg:first-child .charPlate{ left:20px; right:auto; transform:none; --plate-tip-x:28px; }
        #charsBand>.charImg:last-child .charPlate{ left:auto; right:20px; transform:none; --plate-tip-x: calc(100% - 28px); }

        @media (max-width: 780px){
            .charPlate{ padding:10px 5px; top:100%; }
            .charPlate__inner{ flex-direction:column; row-gap:5px; }
            .charPlate .column_1,.charPlate .column_2{ row-gap:5px; }
        }

        .stage::after{
            content:""; position:absolute; left:-5vw; right:-5vw; bottom:-6vh; height:18vh;
            background: radial-gradient(120% 150% at 50% 115%, rgba(0,0,0,.35) 0%, rgba(0,0,0,.18) 38%, rgba(0,0,0,0) 72%);
            pointer-events:none; z-index:3;
        }

        .tail{ min-height:70vh; display:grid; place-items:center; background: radial-gradient(1100px 520px at 70% 15%, #1d2a66 0%, #0b1020 62%); color:#cfd6ff; }
    </style>
</head>
<body>
<header class="site-header" id="siteHeader">
    <button class="nav-toggle" id="navToggle" aria-label="Відкрити меню" aria-controls="primaryNav" aria-expanded="false">
        <span class="nav-toggle-bar" aria-hidden="true"></span>
    </button>

    <nav class="main-nav" id="primaryNav" aria-label="Main">
        <a class="nav-link" href="#intro" data-target="#intro">Особливості</a>
        <a class="nav-link" href="#tail" data-target="#tail">Досліджуй</a>
        <a class="nav-link" href="#gallery" data-target="#gallery">Галерея</a>
        <a class="nav-link" href="#templates" data-target="#templates">Шаблони</a>
        <a class="nav-link" href="#faq" data-target="#faq">FAQ</a>
    </nav>
</header>

<section class="intro sky-gradient1" id="intro">
    <div class="intro-logo"><img src="./assets/fighton.png" alt="FightTON"></div>
    <div class="cloud cloud--lt"><img src="./assets/cloud_left_top.svg" alt=""></div>
    <div class="cloud cloud--rt"><img src="./assets/cloud_right_top.svg" alt=""></div>
    <div class="cloud cloud--lb"><img src="./assets/cloud_left_bottom.svg" alt=""></div>
    <div class="cloud cloud--rb"><img src="./assets/cloud_right_bottom.svg" alt=""></div>
</section>

<div class="stage" id="stage">
    <div class="layer sky-gradient2" id="sky"><div class="band"></div></div>
    <div class="layer" id="sun"><img class="sunImg" src="./assets/sun.svg" alt="Sun"></div>

    <div class="layer" id="mountains">
        <div class="band" id="mountainsBand">
            <img class="mountainsImg" src="./assets/mountains_1.svg" alt="">
            <img class="mountainsImg" src="./assets/mountains_2.svg" alt="">
        </div>
    </div>

    <div class="layer" id="houses">
        <div class="band" id="housesBand">
            <img class="houseImg" src="./assets/house1.png" alt="">
            <img class="houseImg" src="./assets/house2.png" alt="">
            <img class="houseImg" src="./assets/house3.png" alt="">
            <img class="houseImg" src="./assets/house4.png" alt="">
            <img class="houseImg" src="./assets/house5.png" alt="">
            <img class="houseImg" src="./assets/house6.png" alt="">
            <img class="houseImg" src="./assets/house7.png" alt="">
            <img class="houseImg" src="./assets/house8.png" alt="">
          <!--  <img class="houseImg" src="./assets/house9.png" alt="">
            <img class="houseImg" src="./assets/house10.png" alt="">-->
        </div>
    </div>

    <div class="layer" id="streetGround">
        <div class="band" id="streetGroundBand"><div class="streetGroundSpacer"></div></div>
    </div>
    <div class="layer" id="streetSnow">
        <div class="band" id="streetSnowBand"><div class="snowLine"></div><div class="streetSnowSpacer"></div></div>
    </div>

    <div class="layer" id="chars">
        <div class="band" id="charsBand">
            <img class="charImg" src="./assets/Sniper.svg" alt="Sniper" data-plate-title="SNIPER" data-plate-text="Я можу все і навіть трохи більше!">
            <img class="charImg" src="./assets/Gorilla.svg" alt="Gorilla" data-plate-title="GORILLA" data-plate-text="Я можу все і навіть трохи більше!">
            <img class="charImg" src="./assets/Mobster.svg" alt="Mobster" data-plate-title="MOBSTER" data-plate-text="Я можу все і навіть трохи більше!">
            <img class="charImg" src="./assets/Snap.svg" alt="Snap" data-plate-title="SNAP" data-plate-text="...">
            <img class="charImg" src="./assets/Cuadrilla.svg" alt="Cuadrilla" data-plate-title="CUADRILLA" data-plate-text="...">
            <img class="charImg" src="./assets/Shelldren.svg" alt="Shelldren" data-plate-title="SHELLDREN" data-plate-text="...">
            <img class="charImg" src="./assets/Pistolero.svg" alt="Pistolero" data-plate-title="PISTOLERO" data-plate-text="...">
            <img class="charImg" src="./assets/Machetero.svg" alt="Machetero" data-plate-title="MACHETERO" data-plate-text="...">
            <img class="charImg" src="./assets/Golfer.svg" alt="Golfer" data-plate-title="GOLFER" data-plate-text="..." style="margin-right:6vw">
        </div>
    </div>
</div>

<section class="tail" id="tail"><h2>Далі контент</h2></section>

<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollTrigger.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollToPlugin.min.js"></script>
<script>
    gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);
    gsap.config({nullTargetWarn: false});
</script>
<script>
    /* ===== ХМАРКИ В INTRO (виїжджають назовні) ===== */
    (function introClouds() {
        const tl = gsap.timeline({
            scrollTrigger: {trigger: "#intro", start: "top top", end: "bottom top", scrub: 1}
        });
        const push = () => Math.max(innerWidth * 0.28, 280);
        tl.to(".intro .cloud.cloud--lt", {x: -push(), ease: "none"}, 0);
        tl.to(".intro .cloud.cloud--rt", {x: push(), ease: "none"}, 0);
        tl.to(".intro .cloud.cloud--lb", {x: -push() * 0.8, ease: "none"}, 0);
        tl.to(".intro .cloud.cloud--rb", {x: push() * 0.8, ease: "none"}, 0);
        tl.to(".intro-logo", {y: -40, opacity: 0.92, ease: "none"}, 0);
    })();

    function waitImgs(sel) {
        const imgs = Array.from(document.querySelectorAll(sel + ' img'));
        return Promise.all(imgs.map(i => i.complete ? 1 : new Promise(r => i.addEventListener('load', r, {once: true}))));
    }

    const bandFull = (sel) => {
        const el = document.querySelector(sel);
        if (!el) return 0;
        const w = Math.max(el.scrollWidth, el.getBoundingClientRect().width);
        return Math.max(0, w - innerWidth);
    };
    const startOffset = (sel, k) => -(bandFull(sel) * (1 - k));
    const endOffset = (sel) => -(bandFull(sel));
    const leadPx = (sel, k) => Math.round(bandFull(sel) * (1 - k));

    function recalcStageDims() {
        const charsW = document.getElementById('charsBand')?.scrollWidth || innerWidth * 3;
        const baseWidth = Math.round(Math.max(charsW * 1.05, innerWidth * 3.5));
        document.querySelector('.streetGroundSpacer')?.style && (document.querySelector('.streetGroundSpacer').style.width = baseWidth + 'px');
        document.querySelector('.streetSnowSpacer')?.style && (document.querySelector('.streetSnowSpacer').style.width = baseWidth + 'px');

        document.documentElement.style.setProperty('--mountains-lead', leadPx('#mountainsBand', 0.28) + 'px');
        document.documentElement.style.setProperty('--houses-lead', leadPx('#housesBand', 0.72) + 'px');
    }

    ScrollTrigger.addEventListener('refreshInit', recalcStageDims);

    function initStage() {
        const charsW = document.getElementById('charsBand')?.scrollWidth || innerWidth * 3;

        const groundSpacer = document.querySelector('.streetGroundSpacer');
        const snowSpacer = document.querySelector('.streetSnowSpacer');
        const baseWidth = Math.round(Math.max(charsW * 1.05, innerWidth * 3.5));
        if (groundSpacer) groundSpacer.style.width = baseWidth + 'px';
        if (snowSpacer) snowSpacer.style.width = baseWidth + 'px';

        document.documentElement.style.setProperty('--mountains-lead', leadPx('#mountainsBand', 0.28) + 'px');
        document.documentElement.style.setProperty('--houses-lead', leadPx('#housesBand', 0.72) + 'px');

        const tl = gsap.timeline({
            scrollTrigger: {
                id: "stageParallax",
                trigger: "#stage",
                start: "top top",
                end: () => {
                    const w = bandFull('#charsBand');
                    return "+=" + Math.max(1600, Math.round(w * 1.15));
                },
                pin: true, scrub: 1, anticipatePin: 1, invalidateOnRefresh: true
            }
        });

        /* легка динаміка сонця */
        tl.to('.sunImg', {yPercent: -6, scale: 0.98, ease: 'none', duration: 18}, 0);

      /*  const durChars      = 80;
        const durGround     = 88;
        const durHouses     = 96;
        const durMountains  = 110;
*/
        const durChars      = 70;
        const durGround     = 88;
        const durHouses     = 110;
        const durMountains  = 150;

        const cssVarPx = (name) =>
            parseFloat(getComputedStyle(document.documentElement).getPropertyValue(name)) || 0;

        /* ГОРИ — старт із урахуванням lead, повільні */
        tl.fromTo('#mountainsBand',
            {x: () => -cssVarPx('--mountains-lead')},
            {x: () => endOffset('#mountainsBand'), ease: 'none', duration: durMountains},
            0
        );

        /* БУДИНКИ — повільніші за персонажів */
        tl.fromTo('#housesBand',
            {x: () => -cssVarPx('--houses-lead')},
            {x: () => endOffset('#housesBand'), ease: 'none', duration: durHouses},
            0
        );

        /* ЗЕМЛЯ/СНІГ — близький план, швидше за будинки, але повільніше за персонажів */
        tl.fromTo('#streetGroundBand',
            {x: () => startOffset('#streetGroundBand', 0.90)},
            {x: () => endOffset('#streetGroundBand'), ease: 'none', duration: durGround},
            0
        );
        tl.fromTo('#streetSnowBand',
            {x: () => startOffset('#streetSnowBand', 0.90)},
            {x: () => endOffset('#streetSnowBand'), ease: 'none', duration: durGround},
            0
        );

        /* ПЕРСОНАЖІ — найшвидші */
        tl.fromTo('#charsBand',
            {x: () => startOffset('#charsBand', 1.00)},
            {x: () => endOffset('#charsBand'), ease: 'none', duration: durChars},
            0
        );

        addEventListener('resize', () => ScrollTrigger.refresh());
    }

    const charData = [
        {'price':'83,33 TON','max profit':'up to 204,17 TON','max roi':'up to 245%','daily profit':'2,1250 TON','daily roi':'2,55%','feeding':'1.57 TON'},
        {'price':'33,33 TON','max profit':'up to 76,67 TON','max roi':'up to 230%','daily profit':'0,8167 TON','daily roi':'2,45%','feeding':'0.57 TON'},
        {'price':'16,67 TON','max profit':'up to 35,83 TON','max roi':'up to 215%','daily profit':'0,3917 TON','daily roi':'2,35%','feeding':'0.25 TON'},
        {'price':'16,67 TON','max profit':'up to 35,83 TON','max roi':'up to 215%','daily profit':'0,3917 TON','daily roi':'2,35%','feeding':'0.25 TON'},
        {'price':'8,33 TON','max profit':'up to 16,67 TON','max roi':'up to 200%','daily profit':'0,1917 TON','daily roi':'2,3%','feeding':'0.1 TON'},
        {'price':'3,33 TON','max profit':'up to 6,17 TON','max roi':'up to 185%','daily profit':'0,0750 TON','daily roi':'2,25%','feeding':'0.004 TON'},
        {'price':'1,67 TON','max profit':'up to 2,92 TON','max roi':'up to 175%','daily profit':'0,0750 TON','daily roi':'2,25%','feeding':'0.004 TON'},
        {'price':'1 TON','max profit':'up to 1,60 TON','max roi':'up to 160%','daily profit':'0,0210 TON','daily roi':'2,1%','feeding':'0.008 TON'},
        {'price':'0.33 TON','max profit':'up to 0,50 TON','max roi':'up to 150%','daily profit':'0,0067 TON','daily roi':'2%','feeding':'0.002 TON'},
        {'price':'free','max profit':'up to 0,17 TON','max roi':'up to 100%','daily profit':'0,0020 TON','daily roi':'1.2%','feeding':'0.004 TON'}
    ];

    /* plates + hover: будуємо 2 колонки з charData */
    (function attachPlates() {
        const band = document.getElementById('charsBand');
        if (!band) return;

        const cards = Array.from(band.querySelectorAll('img.charImg, img.charImg.sm, img.charImg.lg'));

        cards.forEach((baseImg, idx) => {
            const data = charData[idx] || null;

            const wrap = document.createElement('span');
            wrap.className = baseImg.className;
            wrap.tabIndex = 0;
            if (baseImg.style.margin) { wrap.style.margin = baseImg.style.margin; baseImg.style.margin = ''; }
            baseImg.className = 'base';

            const hoverSrc = baseImg.dataset.hover || baseImg.src.replace(/(\.[a-z]+)$/i, '_hover$1');
            const hoverImg = new Image();
            hoverImg.className = 'hover';
            hoverImg.alt = baseImg.alt ? baseImg.alt + ' (hover)' : '';
            hoverImg.src = hoverSrc;
            const pre = new Image(); pre.src = hoverSrc;

            const plate = document.createElement('div');
            plate.className = 'charPlate';

            if (data) {
                const inner = document.createElement('div'); inner.className = 'charPlate__inner';
                const col1 = document.createElement('div'); col1.className = 'column_1';
                const col2 = document.createElement('div'); col2.className = 'column_2';

                const entries = Object.entries(data);
                const buildItems = (pairs) => pairs.map(([k, v]) => {
                    const item = document.createElement('div');
                    const p = document.createElement('p'); p.textContent = String(k).toUpperCase();
                    const span = document.createElement('span'); span.textContent = v;
                    item.appendChild(p); item.appendChild(span); return item;
                });

                buildItems(entries.slice(0,3)).forEach(el => col1.appendChild(el));
                buildItems(entries.slice(3,6)).forEach(el => col2.appendChild(el));

                inner.appendChild(col1); inner.appendChild(col2); plate.appendChild(inner);
            }

            baseImg.parentNode.insertBefore(wrap, baseImg);
            wrap.appendChild(baseImg);
            wrap.appendChild(hoverImg);
            if (data) wrap.appendChild(plate);

            wrap.addEventListener('touchstart', () => {
                wrap.classList.add('is-touch');
                clearTimeout(wrap._t);
                wrap._t = setTimeout(() => wrap.classList.remove('is-touch'), 900);
            }, {passive: true});
        });
    })();

    waitImgs('body').then(() => {
        initStage();
        ScrollTrigger.refresh();
    });

    /* ===== СВАЙП ДЛЯ МОБІЛОК НА СЦЕНІ #stage ===== */
    (function () {
        if (!window.matchMedia('(max-width:780px)').matches) return;

        const stage = document.getElementById('stage');
        if (!stage) return;

        let x0 = null, y0 = null;

        function onStart(e) {
            const t = e.touches && e.touches[0];
            if (!t) return; x0 = t.clientX; y0 = t.clientY;
        }

        function onEnd(e) {
            if (x0 == null) return;
            const t = (e.changedTouches && e.changedTouches[0]) || e.touches?.[0];
            x0 = x0 ?? 0; y0 = y0 ?? 0;
            if (!t) { x0 = y0 = null; return; }

            const dx = t.clientX - x0;
            const dy = Math.abs(t.clientY - y0 || 0);

            if (Math.abs(dx) > 40 && Math.abs(dx) > dy * 1.2) {
                const ST = ScrollTrigger.getById('stageParallax');
                const curr = window.scrollY;
                const step = Math.max(innerHeight * 0.45, Math.min(innerHeight * 0.9, Math.abs(dx) * 8));
                const delta = dx < 0 ? step : -step;
                let target = curr + delta;

                if (dx < 0 && ST && curr >= (ST.end - 4)) {
                    document.querySelector('.tail')?.scrollIntoView({behavior: 'smooth'});
                } else {
                    if (ST) { target = Math.max(ST.start, Math.min(ST.end, target)); }
                    window.scrollTo({top: target, behavior: 'smooth'});
                }
            }
            x0 = y0 = null;
        }

        stage.addEventListener('touchstart', onStart, {passive: true});
        stage.addEventListener('touchend', onEnd, {passive: true});
    })();
</script>
<script>
    /* ===== Fixed Header logic ===== */
    (function () {
        const header = document.getElementById('siteHeader');
        const headerH = () => header ? Math.round(header.getBoundingClientRect().height) : 64;

        function syncHeaderVar(){ document.documentElement.style.setProperty('--header-h', headerH() + 'px'); }
        syncHeaderVar();
        addEventListener('resize', () => { syncHeaderVar(); ScrollTrigger.refresh(); });

        function setActiveById(id){
            document.querySelectorAll('.nav-link').forEach(a => {
                const target = a.dataset.target || a.getAttribute('href');
                a.classList.toggle('active', target === id);
            });
        }

        document.querySelectorAll('.nav-link').forEach(a => {
            a.addEventListener('click', (e) => {
                e.preventDefault();
                const sel = a.dataset.target || a.getAttribute('href');
                setActiveById(sel);
                gsap.to(window, { duration: 0.8, ease: 'power2.out', scrollTo: {y: sel, offsetY: headerH()} });
                document.documentElement.classList.remove('nav-open');
                document.getElementById('navToggle')?.setAttribute('aria-expanded', 'false');
            });
        });

        const SECTIONS = ['#intro', '#tail', '#gallery', '#templates', '#faq'];
        let currentActive = null, rafRunning = false;

        function updateActive() {
            rafRunning = false;
            const y = headerH();
            const hysteresis = 10;
            let winner = null;

            for (const id of SECTIONS) {
                const el = document.querySelector(id);
                if (!el) continue;
                const r = el.getBoundingClientRect();
                if (r.top <= y + hysteresis && r.bottom > y + hysteresis) { winner = id; break; }
            }
            if (!winner) {
                let best = Infinity;
                for (const id of SECTIONS) {
                    const el = document.querySelector(id);
                    if (!el) continue;
                    const dist = Math.abs(el.getBoundingClientRect().top - y);
                    if (dist < best) { best = dist; winner = id; }
                }
            }
            if (winner && winner !== currentActive) {
                currentActive = winner;
                setActiveById(winner);
            }
        }

        function onScroll(){ if (!rafRunning){ rafRunning = true; requestAnimationFrame(updateActive); } }

        addEventListener('scroll', onScroll, {passive: true});
        addEventListener('resize', updateActive);
        addEventListener('load', () => {
            const hash = window.location.hash;
            if (hash && document.querySelector(hash)) {
                gsap.set(window, {scrollTo: {y: hash, offsetY: headerH(), autoKill: false}});
            }
            updateActive();
            ScrollTrigger.refresh();
        });

        const navToggle = document.getElementById('navToggle');
        function closeNav(){ document.documentElement.classList.remove('nav-open'); navToggle?.setAttribute('aria-expanded','false'); }
        function openNav(){ document.documentElement.classList.add('nav-open'); navToggle?.setAttribute('aria-expanded','true'); }
        function toggleNav(){ if (document.documentElement.classList.contains('nav-open')) closeNav(); else openNav(); }
        navToggle?.addEventListener('click', toggleNav);
        addEventListener('keydown', (e) => { if (e.key === 'Escape') closeNav(); });
        addEventListener('resize', () => { if (matchMedia('(min-width:781px)').matches) closeNav(); });
    })();
</script>
</body>
</html>
