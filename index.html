<!doctype html>
<html lang="uk">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>FightON</title>

    <style>
        :root{
            --char-drop: calc(-6vh);
            --header-h: 64px;
        }
        html,body{margin:0;background:#0b1020;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
        body{padding-top:var(--header-h);}
        .stage,section{scroll-margin-top:var(--header-h);}

        /* HEADER (мінімально) */
        .site-header{
            position:fixed;inset:0 0 auto 0;height:var(--header-h);z-index:10000;
            display:flex;align-items:center;gap:16px;padding:0 18px;
            backdrop-filter:blur(10px);
            background:linear-gradient(180deg,rgba(10,14,30,.72),rgba(10,14,30,.46));
            border-bottom:1px solid rgba(255,255,255,.08);
        }
        .logo{color:#fff;text-decoration:none;font-weight:800;}

        /* SCENE */
        .stage{position:relative;height:200vh;overflow:hidden;}
        .layer{position:absolute;inset:0;pointer-events:none;}
        .band{
            position:absolute;left:0;bottom:0;height:100%;
            width:auto;min-width:100%;
            display:flex;align-items:flex-end;will-change:transform;white-space:nowrap;
        }
        /* прибираємо «хвости», що давали порожнечі */
        .band::after{content:"";flex:0 0 0;}

        /* порядок шарів */
        #sky{z-index:1}
        #sun{z-index:2}            /* сонце ПІД горами */
        #clouds{z-index:3}
        #mountains{z-index:4}
        #houses{z-index:5}
        #street{z-index:6}
        #chars{z-index:7}

        /* SKY */
        #sky{
            background:
                    radial-gradient(900px 520px at 65% 10%,rgba(255,255,255,.18) 0%,rgba(255,255,255,0) 60%),
                    linear-gradient(180deg,#7A8CF1 0%,#6FA2FA 28%,#79C3FF 62%,#CFEFFF 88%,#F6FDFF 100%);
        }
        #sky::before{
            content:"";position:absolute;left:50%;top:8vh;transform:translateX(-50%);
            width:70vmin;height:70vmin;border-radius:50%;
            background:radial-gradient(circle at 50% 50%,#fff 0 10%,#fff8 10% 26%,#fff3 26% 42%,transparent 60%);
            filter:blur(18px);opacity:.28;
        }

        /* логотип */
        .stage-logo{position:absolute;top:calc(var(--header-h) + 8px);left:50%;transform:translateX(-50%);z-index:9;pointer-events:none;}
        .stage-logo img{width:clamp(140px,32vw,360px);height:auto;display:block;filter:drop-shadow(0 6px 14px rgba(0,0,0,.25));}

        /* SUN — нижче, щоб визирало з-за гір */
        #sun{display:grid;place-items:center;}
        .sunImg{
            width:min(22vmax,420px);height:auto;position:absolute;left:50%;transform:translateX(-50%);
            bottom:42%;opacity:.93;filter:blur(.2px);
        }

        /* CLOUDS (верх сцени) */
        #clouds .cloudImg{
            height:24%;width:auto;margin:0 8vw 60vh;flex:0 0 auto;opacity:.98;
            filter:drop-shadow(0 6px 14px rgba(0,0,0,.12));
        }

        /* MOUNTAINS / HOUSES */
        .mountainsImg{height:34vh;width:auto;margin:0 8vw 16vh;filter:drop-shadow(0 10px 24px rgba(0,0,0,.25));}
        .houseImg{height:46vh;width:auto;margin:0 40px 12vh;filter:drop-shadow(0 10px 26px rgba(0,0,0,.28));}

        /* STREET — без дірок (repeat-x) */
        #street .band{
            background:url("./assets/street.svg") repeat-x left bottom;
            background-size:auto 28vh;
        }
        .streetSpacer{width:600vw;height:28vh;} /* довгу «дорогу» далі прокрутимо gsap'ом */

        /* CHARS */
        .charImg{
            width:240px;height:auto;margin:0 100px 0;
            transform:translateY(var(--char-drop));
            filter:drop-shadow(0 12px 34px rgba(0,0,0,.35));flex:0 0 auto;
        }
        .charImg.sm{width:200px}.charImg.lg{width:280px}

        @media (max-width:780px){
            :root{--char-drop:calc(-5vh);}
            .houseImg{height:42vh;margin-bottom:10vh}
            #street .band{background-size:auto 26vh}
            .streetSpacer{height:26vh}
        }

        /* невелика тінь «землі» */
        .stage::after{
            content:"";position:absolute;left:-5vw;right:-5vw;bottom:-6vh;height:22vh;
            background:radial-gradient(120% 150% at 50% 115%,rgba(0,0,0,.35) 0%,rgba(0,0,0,.18) 38%,rgba(0,0,0,0) 72%);
            pointer-events:none;z-index:3;
        }

        /* секція після сцени, щоб зняти pin */
        .tail{min-height:80vh;display:grid;place-items:center;background:radial-gradient(1100px 520px at 70% 15%,#1d2a66 0%,#0b1020 62%);color:#cfd6ff;}
    </style>
</head>
<body>
<header class="site-header"><a class="logo" href="#stage">CyberGame</a></header>

<div class="stage" id="stage">
    <div class="stage-logo"><img src="./assets/fighton.png" alt="FightTON logo"></div>

    <!-- SKY -->
    <div class="layer" id="sky"><div class="band" id="skyBand"></div></div>

    <!-- SUN (позаду гір) -->
    <div class="layer" id="sun"><img class="sunImg" src="./assets/sun.svg" alt="Sun"></div>

    <!-- CLOUDS -->
    <div class="layer" id="clouds">
        <div class="band" id="cloudsBand">
            <img class="cloudImg" src="./assets/cloud_left_top.svg" alt="">
            <img class="cloudImg" src="./assets/cloud_right_top.svg" alt="">
            <img class="cloudImg" src="./assets/cloud_left_bottom.svg" alt="">
            <img class="cloudImg" src="./assets/cloud_right_bottom.svg" alt="">
        </div>
    </div>

    <!-- MOUNTAINS -->
    <div class="layer" id="mountains">
        <div class="band" id="mountainsBand">
            <img class="mountainsImg" src="./assets/mountains.svg" alt="" style="margin-left:8vw">
            <img class="mountainsImg" src="./assets/mountains.svg" alt="" style="margin-right:8vw">
        </div>
    </div>

    <!-- HOUSES -->
    <div class="layer" id="houses">
        <div class="band" id="housesBand">
            <img class="houseImg" src="./assets/house1.png" alt="" style="margin-left:6vw">
            <img class="houseImg" src="./assets/house2.png" alt="">
            <img class="houseImg" src="./assets/house3.png" alt="">
            <img class="houseImg" src="./assets/house4.png" alt="">
            <img class="houseImg" src="./assets/house5.png" alt="">
            <img class="houseImg" src="./assets/house6.png" alt="">
            <img class="houseImg" src="./assets/house7.png" alt="">
            <img class="houseImg" src="./assets/house8.png" alt="">
            <img class="houseImg" src="./assets/house9.png" alt="" style="margin-right:8vw">
        </div>
    </div>

    <!-- STREET (repeat-x фон) -->
    <div class="layer" id="street"><div class="band" id="streetBand"><div class="streetSpacer"></div></div></div>

    <!-- CHARS -->
    <div class="layer" id="chars">
        <div class="band" id="charsBand">
            <img class="charImg"    src="./assets/Sniper.svg"     alt="" style="margin-left:6vw">
            <img class="charImg"    src="./assets/Gorilla.svg"    alt="">
            <img class="charImg"    src="./assets/Mobster.svg"    alt="">
            <img class="charImg"    src="./assets/Snap.svg"       alt="">
            <img class="charImg"    src="./assets/Cuadrilla.svg"  alt="">
            <img class="charImg"    src="./assets/Shelldren.svg"  alt="">
            <img class="charImg"    src="./assets/Pistolero.svg"  alt="">
            <img class="charImg"    src="./assets/Machetero.svg"  alt="">
            <img class="charImg lg" src="./assets/Golfer.svg"     alt="" style="margin-right:8vw">
        </div>
    </div>
</div>

<section class="tail"><h2>Далі контент</h2></section>

<!-- GSAP -->
<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollTrigger.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollToPlugin.min.js"></script>
<script>
    gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);
    gsap.config({nullTargetWarn:false});

    /* чекаємо поки всі картинки сцени завантажаться */
    function whenStageImagesReady(){
        const imgs = Array.from(document.querySelectorAll('#stage img'));
        return Promise.all(imgs.map(img => img.complete ? Promise.resolve()
            : new Promise(res => img.addEventListener('load', res, {once:true}))));
    }

    function bandShift(sel, k=1){
        const el = document.querySelector(sel);
        if (!el) return 0;
        const width = Math.max(el.scrollWidth, el.getBoundingClientRect().width);
        return -Math.max(0, width - innerWidth) * k;
    }

    function initParallax(){
        /* двофазний таймлайн: 35% — небо/хмари, 65% — земля */
        const tl = gsap.timeline({
            scrollTrigger:{
                id:"stageParallax",
                trigger:"#stage",
                start:"top top",
                end: () => {
                    const el = document.getElementById('charsBand');
                    const w = el ? Math.max(el.scrollWidth, el.getBoundingClientRect().width) : innerWidth*3;
                    return "+=" + Math.max(2400, Math.round((w - innerWidth) * 1.35));
                },
                pin:true, scrub:1, anticipatePin:1, invalidateOnRefresh:true
            }
        });

        /* --- ФАЗА 1: НЕБО (0 → 35) --- */
        tl.add('skyPhase', 0);

        // легкий рух сонця, але воно за горами
        tl.to('.sunImg', {yPercent:-10, scale:0.96, ease:'none', duration:35}, 'skyPhase');

        // хмари розʼїжджаються і ЗНИКАЮТЬ
        const clouds = gsap.utils.toArray('#clouds .cloudImg');
        clouds.forEach((c,i)=>{
            const dir = (i%2===0)?-1:1;
            tl.to(c, {x: () => dir*(innerWidth*0.45), y:(i%3===0)?-20:8, opacity:0, ease:'power1.inOut', duration:35}, 'skyPhase');
        });
        tl.add(()=>gsap.set('#clouds',{display:'none',pointerEvents:'none'}), 'skyPhase+=34.5'); // повністю прибрали

        /* --- ФАЗА 2: ЗЕМЛЯ (35 → 100) --- */
        tl.add('groundPhase', '+=0'); // позиція — після 1-ї фази
        const groundDur = 65;

        tl.to('#mountainsBand', {x: () => bandShift('#mountainsBand', .28), ease:'none', duration:groundDur}, 'groundPhase')
            .to('#housesBand',    {x: () => bandShift('#housesBand',    .72), ease:'none', duration:groundDur}, 'groundPhase')
            .to('#streetBand',    {x: () => bandShift('#streetBand',    .90), ease:'none', duration:groundDur}, 'groundPhase')
            .to('#charsBand',     {x: () => bandShift('#charsBand',     1.00), ease:'none', duration:groundDur}, 'groundPhase');

        addEventListener('resize', () => ScrollTrigger.refresh());
    }

    whenStageImagesReady().then(()=>{
        initParallax();
        ScrollTrigger.refresh();
    });

    addEventListener('load', () => setTimeout(()=>ScrollTrigger.refresh(),0));
</script>
</body>
</html>
